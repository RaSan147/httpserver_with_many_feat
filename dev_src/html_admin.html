

<h1 style="text-align: center;">Admin Page</h1>
<hr>




<!-- check if update available -->

<div>
	<p class="update_text" id="update_text">Checking for Update...</p>
	<!-- <div class="pagination jsonly" onclick="run_update()" id="run_update" style="display: none;">Run Update</div> -->
	<br><br>
</div>

<div>
	<table class="users_list">
		<tr>
			<th>Username</th>
			<th>Permissions</th>
			<th>Actions</th>
		</tr>
	</table>
</div>



<div class='pagination jsonly' onclick="request_reload()">RELOAD SERVER ðŸ§¹</div>
<noscript><a href="/?reload" class='pagination'>RELOAD SERVER ðŸ§¹</a><br></noscript>
<hr>

<div class='pagination jsonly' onclick="request_shutdown()">Shut down ðŸ”»</div>

<script>


function request_reload() {
	fetch('/?reload');
}

function request_shutdown() {
	r_u_sure({y:()=>{
		fetch('/?shutdown')
		.then(response => response.text())
		.then(data => {
			popup_msg.createPopup(data)
		})

	}});
}


class Updater{
	async check_update() {
		fetch('/?update')
		.then(response => {
			console.log(response);
			return response.json()
		}).then(data => {
			if (data.update_available) {
				byId("update_text").innerText = "Update Available! ðŸŽ‰ Latest Version: " + data.latest_version ;
				byId("update_text").style.backgroundColor = "#00cc0033";

				byId("run_update").style.display = "block";
			} else {
				byId("update_text").innerText = "No Update Available";
				byId("update_text").style.backgroundColor = "#888";
			}
		})
		.catch(async err => {
			byId("update_text").innerText = "Update Error: " + "Invalid Response";
			byId("update_text").style.backgroundColor = "#CC000033";
		});
	}

	// run_update() {
	// 	byId("update_text").innerText = "Updating...";
	// 	fetch('/?update_now')
	// 	.then(response => response.json())
	// 	.then(data => {
	// 		if (data.status) {
	// 			byId("update_text").innerHTML = data.message;
	// 			byId("update_text").style.backgroundColor = "green";

	// 		} else {
	// 			byId("update_text").innerHTML = data.message;
	// 			byId("update_text").style.backgroundColor = "#bbb";
	// 		}
	// 	})
	// 	.catch(err => {
	// 		byId("update_text").innerText = "Update Error: " + "Invalid Response";
	// 		byId("update_text").style.backgroundColor = "#CC000033";
	// 	})


	// 	byId("run_update").style.display = "none";
	// }

}

var updater = new Updater();
updater.check_update();


class Admin_tools {
	constructor(){
		this.user_list = [];
		this.get_users();
	}

	async get_users() {
		fetch('/?get_users')
		.then(response => response.json())
		.then(data => {
			this.user_list = data;
			this.display_users();
		})
		.catch(err => {
			console.log(err);
		})
	}

	display_users() {
		var table = byClass("users_list")[0];
		var rows = table.rows.length;
		for (let i = 1; i < rows; i++) {
			table.deleteRow(1);
		}

		for (let i = 0; i < this.user_list.length; i++) {
			var row = table.insertRow(-1);
			row.innerHTML = "<td>" + this.user_list[i] + "</td><td><div class='pagination' onclick='admin_tools.update_user_perm(" + i +
				")'>Permissions</div></td></td><td><div class='pagination' onclick='admin_tools.delete_user(" + i +
					")'>Delete</div></td>";
		}
	}

	update_user_perm(index) {
		var username = this.user_list[index];
		var perms = prompt("Enter new permissions for " + username + ":", "admin");
		if (perms != null) {
			fetch('/?update_user_perm=' + username + "&perms=" + perms)
			.then(response => response.text())
			.then(data => {
				popup_msg.createPopup(data);
				this.get_users();
			})
			.catch(err => {
				console.log(err);
			})
		}
	}

	delete_user(index) {
		console.log(index);
		var username = this.user_list[index];
		r_u_sure({y:()=>{
			fetch('/?delete_user=' + username)
			.then(response => response.text())
			.then(data => {
				popup_msg.createPopup(data);
				this.get_users();
			})
			.catch(err => {
				console.log(err);
			})
		}});
	}
}

var admin_tools = new Admin_tools();





</script>

</body>
